<!DOCTYPE html>
<html class="light" lang="<%= typeof lang !== 'undefined' ? lang : 'ar' %>"
    dir="<%= typeof dir !== 'undefined' ? dir : 'rtl' %>">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>
        <%= typeof title !=='undefined' ? title + ' - ' : '' %>
            <%= t('admin.dashboard', 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' ) %> - <%= t('common.brand', 'Ø²ÙŠØªÙˆÙ† Ù…ØµØ±' ) %>
    </title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700;800&family=Tajawal:wght@400;500;700&family=Inter:wght@300;400;500;600;700&display=swap"
        rel="stylesheet">

    <!-- Material Symbols -->
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>

    <!-- Theme Configuration -->
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#6e8137",
                        "primary-dark": "#56662a",
                        "primary-light": "#8fa34d",
                        "accent": "#d4a017",
                        "background-light": "#f6f8f6",
                        "background-dark": "#102216",
                        "surface": "#ffffff",
                        "surface-dark": "#1a2e22",
                    },
                    fontFamily: {
                        "display": ["Cairo", "Tajawal", "sans-serif"],
                        "body": ["Cairo", "sans-serif"]
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "0.75rem",
                        "xl": "1rem",
                        "full": "9999px"
                    },
                },
            },
        }
    </script>

    <!-- Custom Styles -->
    <link rel="stylesheet" href="/css/style.css">

    <style>
        body {
            font-family: 'Cairo', 'Tajawal', sans-serif;
        }

        .material-symbols-outlined {
            font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        .material-symbols-outlined.fill {
            font-variation-settings: 'FILL' 1, 'wght' 400, 'GRAD' 0, 'opsz' 24;
        }

        html[dir="ltr"] body {
            font-family: 'Inter', sans-serif;
        }

        .lang-dropdown {
            min-width: 120px;
        }
    </style>

    <!-- i18n Setup -->
    <script>
            (function () {
                const lang = localStorage.getItem('lang') || 'ar';
                const dir = lang === 'ar' ? 'rtl' : 'ltr';
                document.documentElement.lang = lang;
                document.documentElement.dir = dir;
            })();
    </script>
</head>

<body class="bg-background-light text-slate-900 font-body min-h-screen flex overflow-hidden">

    <!-- Sidebar Navigation -->
    <aside
        class="w-72 bg-white border-l border-gray-100 flex-shrink-0 hidden lg:flex flex-col h-screen overflow-y-auto rtl:border-l ltr:border-r">
        <div class="p-6">
            <!-- Logo -->
            <div class="flex items-center gap-3 mb-8">
                <div class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center">
                    <span class="material-symbols-outlined text-primary text-2xl">water_drop</span>
                </div>
                <div class="flex flex-col">
                    <h1 class="text-slate-900 text-lg font-bold leading-none mb-0.5">
                        <%= t('common.brand', 'Ø²ÙŠØªÙˆÙ† Ù…ØµØ±' ) %>
                    </h1>
                    <p class="text-primary text-xs font-medium">
                        <%= t('admin.common.panelTitle', 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' ) %>
                    </p>
                </div>
            </div>

            <!-- Navigation -->
            <nav class="flex flex-col gap-1.5">
                <a href="/admin"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'dashboard' ? 'active' : '' %>">
                    <span
                        class="material-symbols-outlined <%= typeof currentPage !== 'undefined' && currentPage === 'dashboard' ? 'fill' : '' %>">dashboard</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.dashboard', 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' ) %>
                    </span>
                </a>

                <a href="/admin/products"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'products' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">inventory_2</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.products', 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' ) %>
                    </span>
                </a>

                <a href="/admin/categories"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'categories' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">folder</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.categories', 'Ø§Ù„ÙØ¦Ø§Øª' ) %>
                    </span>
                </a>

                <a href="/admin/orders"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'orders' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">shopping_bag</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.orders', 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª' ) %>
                    </span>
                    <% if (typeof pendingOrdersCount !=='undefined' && pendingOrdersCount> 0) { %>
                        <span
                            class="mr-auto bg-amber-100 text-amber-800 text-[10px] font-bold px-2 py-0.5 rounded-full rtl:mr-auto ltr:ml-auto">
                            <%= pendingOrdersCount %>
                        </span>
                        <% } %>
                </a>

                <a href="/admin/customers"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'customers' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">group</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.customers', 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡' ) %>
                    </span>
                </a>

                <div class="h-px bg-gray-100 my-2 mx-4"></div>

                <a href="/admin/files"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'files' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">folder_open</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.files', 'Ø§Ù„Ù…Ù„ÙØ§Øª' ) %>
                    </span>
                </a>

                <a href="/admin/settings"
                    class="admin-nav-item <%= typeof currentPage !== 'undefined' && currentPage === 'settings' ? 'active' : '' %>">
                    <span class="material-symbols-outlined">settings</span>
                    <span class="text-sm font-medium">
                        <%= t('admin.menu.settings', 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' ) %>
                    </span>
                </a>
            </nav>
        </div>

        <!-- User Profile -->
        <div class="mt-auto p-6 border-t border-gray-100">
            <div class="flex items-center gap-3 p-3 rounded-xl bg-gray-50">
                <div
                    class="w-10 h-10 rounded-full bg-primary/20 flex items-center justify-center text-primary font-bold">
                    <% if (typeof admin !=='undefined' && admin.name) { %>
                        <%= admin.name.charAt(0) %>
                            <% } else { %>
                                A
                                <% } %>
                </div>
                <div class="flex flex-col overflow-hidden flex-1">
                    <span class="text-sm font-bold text-slate-900 truncate">
                        <%= typeof admin !=='undefined' ? admin.name : t('admin.common.admin', 'Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' ) %>
                    </span>
                    <span class="text-xs text-slate-500 truncate">
                        <%= typeof admin !=='undefined' ? admin.email : 'admin@store.com' %>
                    </span>
                </div>
                <button id="admin-logout-btn" class="text-slate-400 hover:text-red-500 transition-colors"
                    title="<%= t('auth.logout', 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬') %>">
                    <span class="material-symbols-outlined text-xl">logout</span>
                </button>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 flex flex-col h-screen overflow-hidden">

        <!-- Top Navbar -->
        <header
            class="flex items-center justify-between px-6 lg:px-8 py-4 bg-white border-b border-gray-100 shrink-0 z-20">

            <!-- Mobile Menu Toggle -->
            <button id="admin-mobile-menu-btn" class="lg:hidden p-2 text-slate-600 hover:bg-gray-100 rounded-lg">
                <span class="material-symbols-outlined">menu</span>
            </button>

            <!-- Search Bar -->
            <div class="hidden md:flex flex-1 max-w-md relative">
                <span
                    class="material-symbols-outlined absolute top-1/2 -translate-y-1/2 text-slate-400 rtl:right-3 ltr:left-3">search</span>
                <input type="text"
                    placeholder="<%= t('admin.header.searchPlaceholder', 'Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø·Ù„Ø¨Ø§ØªØŒ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª...') %>"
                    class="w-full bg-gray-50 border-none rounded-lg py-2.5 text-sm focus:ring-2 focus:ring-primary/20 text-slate-900 placeholder-slate-400 rtl:pr-10 rtl:pl-4 ltr:pl-10 ltr:pr-4">
            </div>

            <!-- Right Actions -->
            <div class="flex items-center gap-4 mr-auto rtl:mr-auto ltr:ml-auto">
                <!-- Notifications -->
                <button class="relative p-2 rounded-lg hover:bg-gray-50 text-slate-600 transition-colors">
                    <span class="material-symbols-outlined">notifications</span>
                    <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full border-2 border-white"></span>
                </button>

                <div class="h-8 w-px bg-gray-200 mx-1 hidden sm:block"></div>

                <!-- Quick Add Product -->
                <a href="/admin/products/new"
                    class="flex items-center gap-2 bg-primary text-white hover:bg-primary-dark px-4 py-2 rounded-lg font-bold text-sm transition-all shadow-sm">
                    <span class="material-symbols-outlined text-lg">add</span>
                    <span class="hidden sm:inline">
                        <%= t('admin.header.newProduct', 'Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯' ) %>
                    </span>
                </a>

                <!-- Language Switcher -->
                <div class="relative" id="admin-lang-container">
                    <button id="admin-lang-btn"
                        class="flex items-center gap-1.5 h-10 px-3 rounded-lg hover:bg-gray-50 transition-colors text-sm">
                        <span data-current-flag>ðŸ‡ªðŸ‡¬</span>
                        <span class="hidden md:inline text-slate-600" data-current-lang>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                        <span class="material-symbols-outlined text-slate-400 text-lg">expand_more</span>
                    </button>
                    <div id="admin-lang-dropdown"
                        class="hidden absolute mt-2 bg-white rounded-lg shadow-lg border border-gray-100 py-1 z-50 lang-dropdown rtl:left-0 ltr:right-0">
                        <button
                            class="admin-lang-option flex items-center gap-2 w-full px-4 py-2 text-sm hover:bg-gray-50 transition-colors"
                            data-lang="ar">
                            <span>ðŸ‡ªðŸ‡¬</span>
                            <span>Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</span>
                        </button>
                        <button
                            class="admin-lang-option flex items-center gap-2 w-full px-4 py-2 text-sm hover:bg-gray-50 transition-colors"
                            data-lang="en">
                            <span>ðŸ‡¬ðŸ‡§</span>
                            <span>English</span>
                        </button>
                    </div>
                </div>

                <div class="h-8 w-px bg-gray-200 mx-1 hidden sm:block"></div>

                <!-- View Store -->
                <a href="/" target="_blank"
                    class="hidden lg:flex items-center gap-2 text-slate-600 hover:text-primary transition-colors text-sm">
                    <span class="material-symbols-outlined text-lg">storefront</span>
                    <span data-i18n="admin.viewStore">
                        <%= t('admin.header.viewStore', 'Ø¹Ø±Ø¶ Ø§Ù„Ù…ØªØ¬Ø±' ) %>
                    </span>
                </a>
            </div>
        </header>

        <!-- Mobile Sidebar Overlay -->
        <div id="admin-mobile-overlay" class="fixed inset-0 bg-black/50 z-40 hidden lg:hidden"></div>

        <!-- Mobile Sidebar -->
        <div id="admin-mobile-sidebar"
            class="fixed inset-y-0 w-72 bg-white z-50 transition-transform lg:hidden rtl:right-0 rtl:translate-x-full ltr:left-0 ltr:-translate-x-full">
            <div class="p-6 h-full flex flex-col">
                <!-- Close Button -->
                <button id="admin-mobile-close-btn"
                    class="absolute top-4 p-2 text-slate-600 hover:bg-gray-100 rounded-lg rtl:left-4 ltr:right-4">
                    <span class="material-symbols-outlined">close</span>
                </button>

                <!-- Logo -->
                <div class="flex items-center gap-3 mb-8">
                    <div class="w-10 h-10 bg-primary/10 rounded-xl flex items-center justify-center">
                        <span class="material-symbols-outlined text-primary text-2xl">water_drop</span>
                    </div>
                    <div class="flex flex-col">
                        <h1 class="text-slate-900 text-lg font-bold leading-none mb-0.5">
                            <%= t('common.brand', 'Ø²ÙŠØªÙˆÙ† Ù…ØµØ±' ) %>
                        </h1>
                        <p class="text-primary text-xs font-medium">
                            <%= t('admin.common.panelTitle', 'Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„' ) %>
                        </p>
                    </div>
                </div>

                <!-- Mobile Navigation -->
                <nav class="flex flex-col gap-1.5 flex-1">
                    <a href="/admin" class="admin-nav-item">
                        <span class="material-symbols-outlined">dashboard</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.dashboard', 'Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…' ) %>
                        </span>
                    </a>
                    <a href="/admin/products" class="admin-nav-item">
                        <span class="material-symbols-outlined">inventory_2</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.products', 'Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª' ) %>
                        </span>
                    </a>
                    <a href="/admin/categories" class="admin-nav-item">
                        <span class="material-symbols-outlined">folder</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.categories', 'Ø§Ù„ÙØ¦Ø§Øª' ) %>
                        </span>
                    </a>
                    <a href="/admin/orders" class="admin-nav-item">
                        <span class="material-symbols-outlined">shopping_bag</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.orders', 'Ø§Ù„Ø·Ù„Ø¨Ø§Øª' ) %>
                        </span>
                    </a>
                    <a href="/admin/customers" class="admin-nav-item">
                        <span class="material-symbols-outlined">group</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.customers', 'Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡' ) %>
                        </span>
                    </a>
                    <div class="h-px bg-gray-100 my-2"></div>
                    <a href="/admin/files" class="admin-nav-item">
                        <span class="material-symbols-outlined">folder_open</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.files', 'Ø§Ù„Ù…Ù„ÙØ§Øª' ) %>
                        </span>
                    </a>
                    <a href="/admin/settings" class="admin-nav-item">
                        <span class="material-symbols-outlined">settings</span>
                        <span class="text-sm font-medium">
                            <%= t('admin.menu.settings', 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª' ) %>
                        </span>
                    </a>
                </nav>

                <!-- Logout -->
                <button class="admin-nav-item text-red-600 hover:bg-red-50 mt-auto" id="mobile-logout-btn">
                    <span class="material-symbols-outlined">logout</span>
                    <span class="text-sm font-medium">
                        <%= t('auth.logout', 'ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬' ) %>
                    </span>
                </button>
            </div>
        </div>

        <!-- Scrollable Content Area -->
        <div class="flex-1 overflow-y-auto p-6 lg:p-8 scroll-smooth">
            <div class="max-w-[1400px] mx-auto">
                <%- body %>
            </div>

            <!-- Footer -->
            <footer class="mt-12 mb-4 text-center">
                <p class="text-xs text-slate-400 font-medium">
                    <%= t('common.footer.copyright', 'Â© 2024 Ø²ÙŠØªÙˆÙ† Ù…ØµØ±. Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø©.' ) %>
                </p>
            </footer>
        </div>
    </main>

    <!-- Toast Container -->
    <div id="toast-container" class="fixed bottom-4 left-1/2 transform -translate-x-1/2 z-[9999]"></div>

    <!-- Scripts -->
    <script src="/js/config.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/api.js"></script>
    <script src="/js/auth.js"></script>
    <script src="/js/i18n.js"></script>

    <script>
        // Mobile sidebar toggle
        const mobileMenuBtn = document.getElementById('admin-mobile-menu-btn');
        const mobileOverlay = document.getElementById('admin-mobile-overlay');
        const mobileSidebar = document.getElementById('admin-mobile-sidebar');
        const mobileCloseBtn = document.getElementById('admin-mobile-close-btn');

        // Check direction
        const isRtl = document.documentElement.dir === 'rtl';

        function openMobileSidebar() {
            mobileOverlay?.classList.remove('hidden');
            if (isRtl) {
                mobileSidebar?.classList.remove('translate-x-full');
            } else {
                mobileSidebar?.classList.remove('-translate-x-full');
            }
        }

        function closeMobileSidebar() {
            mobileOverlay?.classList.add('hidden');
            if (isRtl) {
                mobileSidebar?.classList.add('translate-x-full');
            } else {
                mobileSidebar?.classList.add('-translate-x-full');
            }
        }

        mobileMenuBtn?.addEventListener('click', openMobileSidebar);
        mobileOverlay?.addEventListener('click', closeMobileSidebar);
        mobileCloseBtn?.addEventListener('click', closeMobileSidebar);

        // Admin logout
        const logout = () => {
            if (typeof AuthModule !== 'undefined') {
                AuthModule.logout();
            } else {
                localStorage.removeItem('adminToken');
                window.location.href = '/admin/login';
            }
        };

        document.getElementById('admin-logout-btn')?.addEventListener('click', logout);
        document.getElementById('mobile-logout-btn')?.addEventListener('click', logout);

        // Language switcher
        document.getElementById('admin-lang-btn')?.addEventListener('click', (e) => {
            e.stopPropagation();
            document.getElementById('admin-lang-dropdown').classList.toggle('hidden');
        });

        document.querySelectorAll('.admin-lang-option').forEach(btn => {
            btn.addEventListener('click', () => {
                const lang = btn.dataset.lang;
                if (typeof I18n !== 'undefined') {
                    I18n.setLanguage(lang);
                } else {
                    localStorage.setItem('lang', lang);
                    location.reload();
                }
                document.getElementById('admin-lang-dropdown').classList.add('hidden');
            });
        });

        document.addEventListener('click', (e) => {
            const dropdown = document.getElementById('admin-lang-dropdown');
            const container = document.getElementById('admin-lang-container');
            if (dropdown && container && !container.contains(e.target)) {
                dropdown.classList.add('hidden');
            }
        });
    </script>
</body>

</html>